<body>
<h1>What's new in SeExpr?</h1>
<h2><span style="line-height: 1.5em;">Variable Typing</span></h2>
<p>Statically typed variables and support for up to 16-dimensional vectors:</p>
<ul>
<li>Floating point, FP[n], where n is 1..16:</li>
</ul>
<p style="padding-left: 30px;">FP[1] for scalars, eg width, height</p>
<p style="padding-left: 30px;">FP[3] for 3d vectors, eg point, normal, color</p>
<p style="padding-left: 30px;">FP[4] eg quaternion</p>
<p style="padding-left: 30px;">FP[16] eg 4x4 matrix</p>
<ul>
<li><span style="font-size: 10pt; line-height: 1.5em;">String, eg "filename.ptx"</span></li>
<li><span style="font-size: 10pt; line-height: 1.5em;">None, eg statements that don't return values</span></li>
<li><span style="font-size: 10pt;">Error</span></li>
<li>Lifetime modifiers of type:</li>
</ul>
<ol><ol>
<li>Uniform: fixed for a range of evaluations (inspired by Renderman where uniform is constant over a shading grid)</li>
<li>Constant: fixed for all evaluations at all times</li>
<li>Varying: can change on every evaluation point</li>
</ol></ol>
<p></p>
<h2>Expression Evaluation</h2>
<p>Faster expression evaluation using interpreter or using LLVM compiler</p>
<p>The default is set to LLVM evaluation. To set explicitly:</p>
<pre>setenv SE_EXPR_EVAL LLVM</pre>
<pre>setenv SE_EXPR_EVAL INTERPRETER</pre>
<p>While LLVM is faster to evaluate, there is more overhead during prep().</p>
<p>See updated tutorials at <a href="http://wdas.github.io/SeExpr/doxygen/">http://wdas.github.io/SeExpr/doxygen/</a></p>
<p></p>
<h2>Variable Blocks</h2>
<p>Shared variable blocks for evaluating multiple expressions at once.</p>
<p>Threading with variable blocks: each thread could have it's own variable block to operate on independently.</p>
<p>More details on using variable blocks is documented at <a href="http://wdas.github.io/SeExpr/doxygen/varblocks.html">http://wdas.github.io/SeExpr/doxygen/varblocks.html</a></p>
<p></p>
<h2>Miscellaneous</h2>
<p>New recursive descent parser, only used for the Python AST Tools.</p>
<p></p>
<h1>Which versions have these features?</h1>
<p>Internal Disney product SeExpr2, all versions; v1.7.x and higher have support for variable blocks.</p>
<p>Open source version 3.0 on <a href="https://github.com/wdas/SeExpr">https://github.com/wdas/SeExpr</a></p>
<h1>What is LLVM?</h1>
<p>From <a href="http://llvm.org/">http://llvm.org/</a>: "The LLVM Project is a collection of modular and reusable compiler and toolchain technologies." SeExpr uses LLVM under the hood for generating IR (intermediate representation) code from our expression language, to more efficiently evaluate the expressions. For more information, refer to <a href="http://llvm.org/docs/">http://llvm.org/docs/</a>; for a useful tutorial example, see <a href="http://llvm.org/docs/tutorial/index.html">http://llvm.org/docs/tutorial/index.html</a>.</p>
<h1>Why did we make these changes?</h1>
<p>We use our expression language heavily in creating textures and particle effects, in everything from growing fur to growing vegetation. We have over 2,000 expressions in our shared library, in addition to innumerable other uses of expressions throughout our pipeline. And in most cases, each expression is re-computed many times across points on a surface or frames in an animation.  If we can improve the performance of expression evaluation, it has the potential to ripple out to many areas of the production pipeline.</p>
<p></p>
<p>More robust variable typing allows us to better identify expression errors during prep, which happens only once, rather than during evaluation, which repeats multiple times. This allows the expression author to more quickly resolve errors and iterate towards a correct solution faster.</p>
<p></p>
<p>Using LLVM to compile expressions prior to evaluation significantly speeds up the evaluation. The overhead of code generation happens once during the prep process, while the performance improvements are reaped multiple times during evaluation for a noticeable overall speed improvement.</p>
<h1>What are the performance impacts -- any testing metrics?</h1>
<p>Overall, expression evaluation is faster, whether you enable LLVM evaluation or use the native SeExpr interpreter for evaluation.</p>
<p>The following chart shows the percent decrease (or increase) in ms for evaluation of expressions in our our internal shared library, as compared to the previous version of SeExpr.</p>
<p>The blue line shows evaluation time increase or decrease comparing v1 and v2 using the native interpreter. The red line shows the comparison between v1 and v2 using LLVM compilation. (Note: These are older metrics from April, and I'll be re-running for a more current view.)</p>
<p><img alt="expr-performance-chart.jpg" src="./expr-performance-chart.jpg" style="height: 334px; width: 620px;" /></p>
<p>Because of the overhead involved in code generation, running a very simple example expression only once will actually be slower using LLVM. However, our typical use case involves many repetitions of the same expression across the points on a surface or frames in an animation.</p>
<h1>What do I have to change in my code to use this version?</h1>
<p>See <a hrep="./LLVM_Porting.html">Porting your product to SeExpr2 with LLVM code generation</a></p>
<h1>How do I write expression functions or plugins now?</h1>
<p>See <a href="./LLVM_Function_Howto.html">How to Write an Expression Function and Plugin</a></p>
<h1>What are some examples?</h1>
<p>For subclassing an expression, see the CalculatorExpr class in <a href="http://wdas.github.io/SeExpr/doxygen/asciiCalculator_8cpp_source.html">asciiCalculator.cpp</a></p>
<p>For writing a custom expression function, see the CurveFuncX class in <a href="http://wdas.github.io/SeExpr/doxygen/ExprBuiltins_8cpp_source.html#l01296">ExprBuiltins.cpp</a></p>
<h1>How do I use variable blocks?</h1>
<p>See <a href="http://wdas.github.io/SeExpr/doxygen/varblocks.html">http://wdas.github.io/SeExpr/doxygen/varblocks.html</a></p>
<h1>How can I contribute to the code?</h1>
<p>Glad you asked! We've defined a list of github issues with the label "<a href="https://github.com/wdas/SeExpr/issues?q=is%3Aissue+is%3Aopen+label%3Awishlist">wishlist</a>." These are issues we would love to have the community contribute solutions for. Guidelines for contributing will be published.</p>
<h1>Where can I find some developer docs?</h1>
<h2>Design docs</h2>
<ul>
<li><a href="./LLVM_Typing.html">SeExpr Type System Overview</a></li>
<li><a href="./LLVM_Lifetime.html">Type System for SeExpr: Lifetime Qualifier Overview</a></li>
<li><a href="./LLVM_Function_Overview.html">SeExpr User-Defined Function Overview</a></li>
</ul>
<h2>Class docs</h2>
<p>See our <a href="http://wdas.github.io/SeExpr/doxygen/">SeExpr Doxygen</a> page.</p></body>
